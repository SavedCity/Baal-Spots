{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n/* global Promise */\n\n\nvar axeCore = require(\"axe-core\");\n\nvar rIC = require(\"requestidlecallback\");\n\nvar after = require(\"./after\");\n\nvar requestIdleCallback = rIC.request;\nvar cancelIdleCallback = rIC.cancel;\nvar React;\nvar ReactDOM;\nvar logger; // contrasted against Chrome default color of #ffffff\n\nvar lightTheme = {\n  serious: '#d93251',\n  minor: '#d24700',\n  text: 'black'\n}; // contrasted against Safari dark mode color of #535353\n\nvar darkTheme = {\n  serious: '#ffb3b3',\n  minor: '#ffd500',\n  text: 'white'\n};\nvar theme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? darkTheme : lightTheme;\nvar boldCourier = 'font-weight:bold;font-family:Courier;';\nvar critical = \"color:\" + theme.serious + \";font-weight:bold;\";\nvar serious = \"color:\" + theme.serious + \";font-weight:normal;\";\nvar moderate = \"color:\" + theme.minor + \";font-weight:bold;\";\nvar minor = \"color:\" + theme.minor + \";font-weight:normal;\";\nvar defaultReset = \"font-color:\" + theme.text + \";font-weight:normal;\";\nvar idleId;\nvar timeout;\nvar context;\nvar conf;\n\nvar _createElement;\n\nvar components = {};\nvar nodes = [document.documentElement];\nvar cache = {}; // Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\n// @see https://davidwalsh.name/javascript-debounce-function\n\nfunction debounce(func, wait, immediate) {\n  var _timeout;\n\n  return function () {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var later = function () {\n      _timeout = null;\n      if (!immediate) func.apply(_this, args);\n    };\n\n    var callNow = immediate && !_timeout;\n    clearTimeout(_timeout);\n    _timeout = setTimeout(later, wait);\n    if (callNow) func.apply(this, args);\n  };\n}\n/**\n * Return the entire parent tree of a node (from HTML down).\n * @param {Node} node\n * @return {Node[]}\n */\n\n\nfunction getPath(node) {\n  var path = [node];\n\n  while (node && node.nodeName.toLowerCase() !== 'html') {\n    path.push(node.parentNode);\n    node = node.parentNode;\n  }\n\n  if (!node || !node.parentNode) {\n    return null;\n  }\n\n  return path.reverse();\n}\n/**\n * Find the common parent of an array of nodes.\n * @param {Node[]} nodes\n * @return {Node}\n */\n\n\nfunction getCommonParent(nodes) {\n  var path;\n  var nextPath;\n\n  if (nodes.length === 1) {\n    return nodes.pop();\n  }\n\n  while (!path && nodes.length) {\n    path = getPath(nodes.pop());\n  }\n\n  while (nodes.length) {\n    nextPath = getPath(nodes.pop());\n\n    if (nextPath) {\n      path = path.filter(function (node, index) {\n        return nextPath.length > index && nextPath[index] === node;\n      });\n    }\n  }\n\n  return path ? path[path.length - 1] : document;\n}\n/**\n * Log the axe result node to the console\n * @param {NodeResult} node\n * @param {Function} logFn console log function to use (error, warn, log, etc.)\n */\n\n\nfunction logElement(node, logFn) {\n  var el = document.querySelector(node.target.toString());\n\n  if (!el) {\n    logFn('Selector: %c%s', boldCourier, node.target.toString());\n  } else {\n    logFn('Element: %o', el);\n  }\n}\n/**\n * Log the axe result node html tot he console\n * @param {NodeResult} node\n */\n\n\nfunction logHtml(node) {\n  console.log('HTML: %c%s', boldCourier, node.html);\n}\n/**\n * Log the failure message of a node result.\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\n\n\nfunction logFailureMessage(node, key) {\n  // this exists on axe but we don't export it as part of the typescript\n  // namespace, so just let me use it as I need\n  var message = axeCore._audit.data.failureSummaries[key].failureMessage(node[key].map(function (check) {\n    return check.message || '';\n  }));\n\n  console.error(message);\n}\n/**\n * Log as a group the node result and failure message.\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\n\n\nfunction failureSummary(node, key) {\n  if (node[key].length > 0) {\n    logElement(node, console.groupCollapsed);\n    logHtml(node);\n    logFailureMessage(node, key);\n    var relatedNodes_1 = [];\n    node[key].forEach(function (check) {\n      relatedNodes_1 = relatedNodes_1.concat(check.relatedNodes);\n    });\n\n    if (relatedNodes_1.length > 0) {\n      console.groupCollapsed('Related nodes');\n      relatedNodes_1.forEach(function (relatedNode) {\n        logElement(relatedNode, console.log);\n        logHtml(relatedNode);\n      });\n      console.groupEnd();\n    }\n\n    console.groupEnd();\n  }\n}\n/**\n * Run axe against the passed in node and report violations\n * @param {*} node\n * @param {Number} timeout force call of axe.run after the timeout has passed (if not called before)\n * @return {Promise}\n */\n\n\nfunction checkAndReport(node, timeout) {\n  var disableDeduplicate = conf['disableDeduplicate'];\n\n  if (idleId) {\n    cancelIdleCallback(idleId);\n    idleId = undefined;\n  }\n\n  return new Promise(function (resolve, reject) {\n    nodes.push(node);\n    idleId = requestIdleCallback(function () {\n      var n = context;\n\n      if (n === undefined) {\n        n = getCommonParent(nodes.filter(function (node) {\n          return node.isConnected;\n        }));\n\n        if (n.nodeName.toLowerCase() === 'html') {\n          // if the only common parent is the body, then analyze the whole page\n          n = document;\n        }\n      }\n\n      axeCore.configure({\n        allowedOrigins: ['<unsafe_all_origins>']\n      });\n      axeCore.run(n, {\n        reporter: 'v2'\n      }, function (error, results) {\n        if (error) {\n          return reject(error);\n        }\n\n        results.violations = results.violations.filter(function (result) {\n          result.nodes = result.nodes.filter(function (node) {\n            var key = node.target.toString() + result.id;\n            var retVal = !cache[key];\n            cache[key] = key;\n            return disableDeduplicate || retVal;\n          });\n          return !!result.nodes.length;\n        });\n\n        if (results.violations.length) {\n          logger(results);\n        }\n\n        resolve();\n      });\n    }, {\n      timeout: timeout\n    });\n  });\n}\n/**\n * Check the node for violations.\n * @param {Component} component\n */\n\n\nfunction checkNode(component) {\n  var node;\n\n  try {\n    node = ReactDOM.findDOMNode(component);\n  } catch (e) {\n    console.group('%caxe error: could not check node', critical);\n    console.group('%cComponent', serious);\n    console.error(component);\n    console.groupEnd();\n    console.group('%cError', serious);\n    console.error(e);\n    console.groupEnd();\n    console.groupEnd();\n  }\n\n  if (node) {\n    checkAndReport(node, timeout);\n  }\n}\n/**\n * Check the component for violations whenever the DOM updates\n * @param {Component} component\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction componentAfterRender(component) {\n  var debounceCheckNode = debounce(checkNode, timeout, true);\n  after(component, 'componentDidMount', debounceCheckNode);\n  after(component, 'componentDidUpdate', debounceCheckNode);\n}\n/**\n * Add a component to track.\n * @param {Component} component\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction addComponent(component) {\n  var reactInstance = component._reactInternalInstance || {};\n  var reactInstanceDebugID = reactInstance._debugID;\n  var reactFiberInstance = component._reactInternalFiber || {};\n  var reactFiberInstanceDebugID = reactFiberInstance._debugID;\n\n  if (reactInstanceDebugID && !components[reactInstanceDebugID]) {\n    components[reactInstanceDebugID] = component;\n    componentAfterRender(component);\n  } else if (reactFiberInstanceDebugID && !components[reactFiberInstanceDebugID]) {\n    components[reactFiberInstanceDebugID] = component;\n    componentAfterRender(component);\n  }\n}\n/**\n * Log axe violations to console.\n * @param {AxeResults} results\n */\n\n\nfunction logToConsole(results) {\n  console.group('%cNew axe issues', serious);\n  results.violations.forEach(function (result) {\n    var fmt;\n\n    switch (result.impact) {\n      case 'critical':\n        fmt = critical;\n        break;\n\n      case 'serious':\n        fmt = serious;\n        break;\n\n      case 'moderate':\n        fmt = moderate;\n        break;\n\n      case 'minor':\n        fmt = minor;\n        break;\n\n      default:\n        fmt = minor;\n        break;\n    }\n\n    console.groupCollapsed('%c%s: %c%s %s', fmt, result.impact, defaultReset, result.help, result.helpUrl);\n    result.nodes.forEach(function (node) {\n      failureSummary(node, 'any');\n      failureSummary(node, 'none');\n    });\n    console.groupEnd();\n  });\n  console.groupEnd();\n}\n/**\n * Run axe against all changes made in a React app.\n * @parma {React} _React React instance\n * @param {ReactDOM} _ReactDOM ReactDOM instance\n * @param {Number} _timeout debounce timeout in milliseconds\n * @parma {Spec} conf React axe.configure Spec object\n * @param {ElementContext} _context axe ElementContent object\n * @param {Function} _logger Logger implementation\n */\n\n\nfunction reactAxe(_React, _ReactDOM, _timeout, _conf, _context, _logger) {\n  if (_conf === void 0) {\n    _conf = {};\n  }\n\n  React = _React;\n  ReactDOM = _ReactDOM;\n  timeout = _timeout;\n  context = _context;\n  conf = _conf;\n  logger = _logger || logToConsole;\n  var runOnly = conf['runOnly'];\n\n  if (runOnly) {\n    conf['rules'] = axeCore.getRules(runOnly).map(function (rule) {\n      return __assign(__assign({}, rule), {\n        id: rule.ruleId,\n        enabled: true\n      });\n    });\n    conf['disableOtherRules'] = true;\n  }\n\n  if (Object.keys(conf).length > 0) {\n    axeCore.configure(conf);\n  }\n\n  axeCore.configure({\n    allowedOrigins: ['<unsafe_all_origins>']\n  });\n\n  if (!_createElement) {\n    _createElement = React.createElement;\n\n    React.createElement = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var reactEl = _createElement.apply(this, args);\n\n      if (reactEl._owner && reactEl._owner._instance) {\n        addComponent(reactEl._owner._instance);\n      } else if (reactEl._owner && reactEl._owner.stateNode) {\n        addComponent(reactEl._owner.stateNode);\n      }\n\n      return reactEl;\n    };\n  }\n\n  return checkAndReport(document.body, timeout);\n}\n\nmodule.exports = reactAxe;","map":{"version":3,"sources":["../index.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/* global Promise */\nvar axeCore = require(\"axe-core\");\nvar rIC = require(\"requestidlecallback\");\nvar after = require(\"./after\");\nvar requestIdleCallback = rIC.request;\nvar cancelIdleCallback = rIC.cancel;\nvar React;\nvar ReactDOM;\nvar logger;\n// contrasted against Chrome default color of #ffffff\nvar lightTheme = {\n    serious: '#d93251',\n    minor: '#d24700',\n    text: 'black'\n};\n// contrasted against Safari dark mode color of #535353\nvar darkTheme = {\n    serious: '#ffb3b3',\n    minor: '#ffd500',\n    text: 'white'\n};\nvar theme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n    ? darkTheme\n    : lightTheme;\nvar boldCourier = 'font-weight:bold;font-family:Courier;';\nvar critical = \"color:\" + theme.serious + \";font-weight:bold;\";\nvar serious = \"color:\" + theme.serious + \";font-weight:normal;\";\nvar moderate = \"color:\" + theme.minor + \";font-weight:bold;\";\nvar minor = \"color:\" + theme.minor + \";font-weight:normal;\";\nvar defaultReset = \"font-color:\" + theme.text + \";font-weight:normal;\";\nvar idleId;\nvar timeout;\nvar context;\nvar conf;\nvar _createElement;\nvar components = {};\nvar nodes = [document.documentElement];\nvar cache = {};\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\n// @see https://davidwalsh.name/javascript-debounce-function\nfunction debounce(func, wait, immediate) {\n    var _timeout;\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var later = function () {\n            _timeout = null;\n            if (!immediate)\n                func.apply(_this, args);\n        };\n        var callNow = immediate && !_timeout;\n        clearTimeout(_timeout);\n        _timeout = setTimeout(later, wait);\n        if (callNow)\n            func.apply(this, args);\n    };\n}\n/**\n * Return the entire parent tree of a node (from HTML down).\n * @param {Node} node\n * @return {Node[]}\n */\nfunction getPath(node) {\n    var path = [node];\n    while (node && node.nodeName.toLowerCase() !== 'html') {\n        path.push(node.parentNode);\n        node = node.parentNode;\n    }\n    if (!node || !node.parentNode) {\n        return null;\n    }\n    return path.reverse();\n}\n/**\n * Find the common parent of an array of nodes.\n * @param {Node[]} nodes\n * @return {Node}\n */\nfunction getCommonParent(nodes) {\n    var path;\n    var nextPath;\n    if (nodes.length === 1) {\n        return nodes.pop();\n    }\n    while (!path && nodes.length) {\n        path = getPath(nodes.pop());\n    }\n    while (nodes.length) {\n        nextPath = getPath(nodes.pop());\n        if (nextPath) {\n            path = path.filter(function (node, index) {\n                return nextPath.length > index && nextPath[index] === node;\n            });\n        }\n    }\n    return path ? path[path.length - 1] : document;\n}\n/**\n * Log the axe result node to the console\n * @param {NodeResult} node\n * @param {Function} logFn console log function to use (error, warn, log, etc.)\n */\nfunction logElement(node, logFn) {\n    var el = document.querySelector(node.target.toString());\n    if (!el) {\n        logFn('Selector: %c%s', boldCourier, node.target.toString());\n    }\n    else {\n        logFn('Element: %o', el);\n    }\n}\n/**\n * Log the axe result node html tot he console\n * @param {NodeResult} node\n */\nfunction logHtml(node) {\n    console.log('HTML: %c%s', boldCourier, node.html);\n}\n/**\n * Log the failure message of a node result.\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\nfunction logFailureMessage(node, key) {\n    // this exists on axe but we don't export it as part of the typescript\n    // namespace, so just let me use it as I need\n    var message = axeCore._audit.data.failureSummaries[key].failureMessage(node[key].map(function (check) { return check.message || ''; }));\n    console.error(message);\n}\n/**\n * Log as a group the node result and failure message.\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\nfunction failureSummary(node, key) {\n    if (node[key].length > 0) {\n        logElement(node, console.groupCollapsed);\n        logHtml(node);\n        logFailureMessage(node, key);\n        var relatedNodes_1 = [];\n        node[key].forEach(function (check) {\n            relatedNodes_1 = relatedNodes_1.concat(check.relatedNodes);\n        });\n        if (relatedNodes_1.length > 0) {\n            console.groupCollapsed('Related nodes');\n            relatedNodes_1.forEach(function (relatedNode) {\n                logElement(relatedNode, console.log);\n                logHtml(relatedNode);\n            });\n            console.groupEnd();\n        }\n        console.groupEnd();\n    }\n}\n/**\n * Run axe against the passed in node and report violations\n * @param {*} node\n * @param {Number} timeout force call of axe.run after the timeout has passed (if not called before)\n * @return {Promise}\n */\nfunction checkAndReport(node, timeout) {\n    var disableDeduplicate = conf['disableDeduplicate'];\n    if (idleId) {\n        cancelIdleCallback(idleId);\n        idleId = undefined;\n    }\n    return new Promise(function (resolve, reject) {\n        nodes.push(node);\n        idleId = requestIdleCallback(function () {\n            var n = context;\n            if (n === undefined) {\n                n = getCommonParent(nodes.filter(function (node) { return node.isConnected; }));\n                if (n.nodeName.toLowerCase() === 'html') {\n                    // if the only common parent is the body, then analyze the whole page\n                    n = document;\n                }\n            }\n            axeCore.configure({ allowedOrigins: ['<unsafe_all_origins>'] });\n            axeCore.run(n, { reporter: 'v2' }, function (error, results) {\n                if (error) {\n                    return reject(error);\n                }\n                results.violations = results.violations.filter(function (result) {\n                    result.nodes = result.nodes.filter(function (node) {\n                        var key = node.target.toString() + result.id;\n                        var retVal = !cache[key];\n                        cache[key] = key;\n                        return disableDeduplicate || retVal;\n                    });\n                    return !!result.nodes.length;\n                });\n                if (results.violations.length) {\n                    logger(results);\n                }\n                resolve();\n            });\n        }, {\n            timeout: timeout\n        });\n    });\n}\n/**\n * Check the node for violations.\n * @param {Component} component\n */\nfunction checkNode(component) {\n    var node;\n    try {\n        node = ReactDOM.findDOMNode(component);\n    }\n    catch (e) {\n        console.group('%caxe error: could not check node', critical);\n        console.group('%cComponent', serious);\n        console.error(component);\n        console.groupEnd();\n        console.group('%cError', serious);\n        console.error(e);\n        console.groupEnd();\n        console.groupEnd();\n    }\n    if (node) {\n        checkAndReport(node, timeout);\n    }\n}\n/**\n * Check the component for violations whenever the DOM updates\n * @param {Component} component\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction componentAfterRender(component) {\n    var debounceCheckNode = debounce(checkNode, timeout, true);\n    after(component, 'componentDidMount', debounceCheckNode);\n    after(component, 'componentDidUpdate', debounceCheckNode);\n}\n/**\n * Add a component to track.\n * @param {Component} component\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction addComponent(component) {\n    var reactInstance = component._reactInternalInstance || {};\n    var reactInstanceDebugID = reactInstance._debugID;\n    var reactFiberInstance = component._reactInternalFiber || {};\n    var reactFiberInstanceDebugID = reactFiberInstance._debugID;\n    if (reactInstanceDebugID && !components[reactInstanceDebugID]) {\n        components[reactInstanceDebugID] = component;\n        componentAfterRender(component);\n    }\n    else if (reactFiberInstanceDebugID &&\n        !components[reactFiberInstanceDebugID]) {\n        components[reactFiberInstanceDebugID] = component;\n        componentAfterRender(component);\n    }\n}\n/**\n * Log axe violations to console.\n * @param {AxeResults} results\n */\nfunction logToConsole(results) {\n    console.group('%cNew axe issues', serious);\n    results.violations.forEach(function (result) {\n        var fmt;\n        switch (result.impact) {\n            case 'critical':\n                fmt = critical;\n                break;\n            case 'serious':\n                fmt = serious;\n                break;\n            case 'moderate':\n                fmt = moderate;\n                break;\n            case 'minor':\n                fmt = minor;\n                break;\n            default:\n                fmt = minor;\n                break;\n        }\n        console.groupCollapsed('%c%s: %c%s %s', fmt, result.impact, defaultReset, result.help, result.helpUrl);\n        result.nodes.forEach(function (node) {\n            failureSummary(node, 'any');\n            failureSummary(node, 'none');\n        });\n        console.groupEnd();\n    });\n    console.groupEnd();\n}\n/**\n * Run axe against all changes made in a React app.\n * @parma {React} _React React instance\n * @param {ReactDOM} _ReactDOM ReactDOM instance\n * @param {Number} _timeout debounce timeout in milliseconds\n * @parma {Spec} conf React axe.configure Spec object\n * @param {ElementContext} _context axe ElementContent object\n * @param {Function} _logger Logger implementation\n */\nfunction reactAxe(_React, _ReactDOM, _timeout, _conf, _context, _logger) {\n    if (_conf === void 0) { _conf = {}; }\n    React = _React;\n    ReactDOM = _ReactDOM;\n    timeout = _timeout;\n    context = _context;\n    conf = _conf;\n    logger = _logger || logToConsole;\n    var runOnly = conf['runOnly'];\n    if (runOnly) {\n        conf['rules'] = axeCore\n            .getRules(runOnly)\n            .map(function (rule) { return (__assign(__assign({}, rule), { id: rule.ruleId, enabled: true })); });\n        conf['disableOtherRules'] = true;\n    }\n    if (Object.keys(conf).length > 0) {\n        axeCore.configure(conf);\n    }\n    axeCore.configure({ allowedOrigins: ['<unsafe_all_origins>'] });\n    if (!_createElement) {\n        _createElement = React.createElement;\n        React.createElement = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var reactEl = _createElement.apply(this, args);\n            if (reactEl._owner && reactEl._owner._instance) {\n                addComponent(reactEl._owner._instance);\n            }\n            else if (reactEl._owner && reactEl._owner.stateNode) {\n                addComponent(reactEl._owner.stateNode);\n            }\n            return reactEl;\n        };\n    }\n    return checkAndReport(document.body, timeout);\n}\nmodule.exports = reactAxe;\n"]},"metadata":{},"sourceType":"script"}